<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lego Dimensions – Characters & Abilities</title>
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="manifest" href="icons/site.webmanifest">
  <style>
    :root{
      --bg:#0b1020; --panel:#151b2e; --muted:#8ea0bf; --text:#e6eeff; --accent:#5cc8ff; --chip:#223153; --chip2:#2b3a61;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; background:linear-gradient(180deg,#0b1020,#0e1426 200px); color:var(--text)}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,rgba(11,16,32,.95),rgba(11,16,32,.85));backdrop-filter:saturate(140%) blur(10px);border-bottom:1px solid #243254}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-size:clamp(20px,3vw,28px);margin:0 0 8px 0}
    .sub{color:var(--muted);font-size:14px;margin:0}

    /* Controls */
    .controls{display:grid;gap:10px;grid-template-columns:1fr;align-items:end;margin-top:12px}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr 1fr}
    @media(min-width:820px){
      .controls{grid-template-columns:1.2fr 1fr}
      .row{grid-template-columns:repeat(4,1fr)}
    }
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input,select{width:100%;background:var(--panel);border:1px solid #263657;color:var(--text);padding:10px 12px;border-radius:12px;outline:none}
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(92,200,255,.15)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .chip{background:var(--chip);border:1px solid #32466f;color:var(--text);padding:6px 10px;border-radius:999px;font-size:12px}
    .pill{background:#0f1a34;border:1px solid #2a3c63;color:var(--muted);padding:6px 10px;border-radius:999px;font-size:12px}

    /* Grid */
    .grid{display:grid;gap:14px;margin:18px 0 40px}
    @media(min-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1050px){.grid{grid-template-columns:repeat(3,1fr)}}

    .card{background:linear-gradient(180deg,#131a2c,#10172a);border:1px solid #223153;border-radius:16px;overflow:hidden;display:flex;gap:12px;padding:12px}
    .card img{width:110px;height:110px;object-fit:contain;background:radial-gradient(120px 120px at 50% 50%,#0e1530,#0b1020);border-radius:12px;border:1px solid #1c2744}
    .card-body{flex:1;min-width:0}
    .title{display:flex;align-items:center;gap:8px}
    .title h3{font-size:18px;line-height:1.2;margin:0}
    .meta{color:var(--muted);font-size:12px}
    .abilities{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
    .ability{background:var(--chip2);border:1px solid #334973;color:#cfe2ff;padding:4px 8px;border-radius:999px;font-size:12px}
    /* Nettere layout voor de pack-regel */
    .pack {
      display: flex;
      flex-wrap: wrap;          /* mag naar een volgende regel */
      gap: 8px 10px;            /* horizontale + verticale ruimte */
      align-items: center;
      margin-top: 10px;
      line-height: 1.35;
      font-size: 13px;
    }
    .pack .pill { flex: 0 0 auto; }
    .pack .pack-name {
      font-weight: 700;
      word-break: keep-all;     /* niet midden in woorden breken */
      overflow-wrap: anywhere;  /* mag wel op spaties breken */
      color:#cfe2ff;            /* zelfde kleur als eerst */
    }
    .pack .pack-wave { color: var(--muted); flex: 0 0 auto; }

    .count { font-weight:600; color:#b7d9ff }

    .toolbar{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:8px}
    .btn{background:#1a2544;border:1px solid #2a3c63;color:#d7e6ff;padding:8px 12px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn[aria-pressed="true"]{outline:2px solid var(--accent)}
    .ghost{background:transparent}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    footer{border-top:1px solid #243254}
    a{color:#9bd6ff}

    /* Groeptitels */
    .group-title{
      grid-column: 1 / -1;
      margin:24px 6px 8px;
      font-size:18px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>LEGO Dimensions – Characters</h1>
      <p class="sub">Filter on ability, franchise, pack type or wave. Search inside a name or franchise.</p>
      <div class="controls" role="search">
        <div>
          <label for="q">Zoeken</label>
          <input id="q" name="q" type="search" placeholder="Bijv. Batman, Ghostbusters, Portal…" autocomplete="off" />
          <div class="chips" id="activeChips" aria-live="polite"></div>
        </div>
        <div class="row">
          <div>
            <label for="franchise">Franchise</label>
            <select id="franchise"><option value="">Alle</option></select>
          </div>
          <div>
            <label for="type">Pack type</label>
            <select id="type"><option value="">Alle</option><option>Starter</option><option>Story</option><option>Level</option><option>Team</option><option>Fun</option></select>
          </div>
          <div>
            <label for="wave">Release wave</label>
            <select id="wave"><option value="">Alle</option><option>1</option><option>2</option></select>
          </div>
          <div>
            <label for="ability">Ability</label>
            <select id="ability"><option value="">(kies een ability)</option></select>
          </div>
        </div>
        <div class="toolbar" aria-label="hulpmiddelen">
          <button id="clearFilters" class="btn ghost" type="button">Filters wissen</button>
          <span class="pill" id="count">0 resultaten</span>
          <button id="groupPack" class="btn" type="button" aria-pressed="false">Groepeer per pack</button>
          <button id="groupFranchise" class="btn" type="button" aria-pressed="false">Groepeer per franchise</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <footer class="container" style="padding:22px 16px 40px">
    <small class="sub">Deze site leest <code>characters.json</code> uit dezelfde map. Tip: commit <code>index.html</code> en <code>characters.json</code> naar GitHub en zet Pages aan.</small>
  </footer>

  <template id="cardTemplate">
    <article class="card" tabindex="0">
      <img alt="minifig" loading="lazy"/>
      <div class="card-body">
        <div class="title">
          <h3 class="name"></h3>
        </div>
        <div class="meta franchise"></div>
        <div class="abilities" aria-label="Abilities"></div>
        <div class="pack"></div>
      </div>
    </article>
  </template>

  <script>
    const $ = (q, el=document) => el.querySelector(q);

    const state = {
      data: [],
      filters: { q:'', franchise:'', type:'', wave:'', abilities:[] },
      groupByPack:false,
      groupByFranchise:false
    };

    async function load(){
      const res = await fetch('./characters.json',{cache:'no-store'});
      const txt = await res.text();
      const json = JSON.parse(txt);
      state.data = Array.isArray(json)? json : (json.characters||[]);
      normalize(state.data);
      buildFilterOptions(state.data);
      render();
    }

    function normalize(list){
      for(const c of list){
        if(!Array.isArray(c.abilities)) c.abilities=[];
        c.pack = c.pack||{}; c.pack.type = c.pack.type||'Onbekend';
        if(c.pack.releaseWave!=null) c.pack.releaseWave=String(c.pack.releaseWave);
      }
    }

    function buildFilterOptions(list){
      const franchises=[...new Set(list.map(c=>c.franchise).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'nl'));
      const abilities=[...new Set(list.flatMap(c=>c.abilities||[]))].sort((a,b)=>a.localeCompare(b,'nl'));
      const $fr=$('#franchise');
      franchises.forEach(f=>{const o=document.createElement('option');o.value=f;o.textContent=f;$fr.appendChild(o);});
      const $ab=$('#ability');
      abilities.forEach(a=>{const o=document.createElement('option');o.value=a;o.textContent=a;$ab.appendChild(o);});
    }

    function filterData(){
      const {q,franchise,type,wave,abilities}=state.filters;
      const ql=q.trim().toLowerCase();
      return state.data.filter(c=>{
        const matchesQ=!ql||(c.name?.toLowerCase().includes(ql)||c.franchise?.toLowerCase().includes(ql));
        const matchesF=!franchise||c.franchise===franchise;
        const matchesT=!type||c.pack?.type===type;
        const matchesW=!wave||String(c.pack?.releaseWave)===String(wave);
        const matchesA=!abilities.length||abilities.every(a=>(c.abilities||[]).includes(a));
        return matchesQ&&matchesF&&matchesT&&matchesW&&matchesA;
      }).sort((a,b)=>a.name.localeCompare(b.name,'nl'));
    }

    function groupBy(items, keyFn){
      return items.reduce((acc,item)=>{const k=keyFn(item);(acc[k]||(acc[k]=[])).push(item);return acc;},{});}

    function render(){
      const grid=$('#grid');
      const items=filterData();
      $('#count').textContent=`${items.length} resultaten`;
      grid.innerHTML='';

      if(state.groupByPack){
        const grouped=groupBy(items,c=>`${c.pack?.type||'Onbekend'} | ${c.pack?.name||'Onbekend'} | Wave ${c.pack?.releaseWave||'?'}`);
        const groups=Object.entries(grouped).sort((a,b)=>a[0].localeCompare(b[0],'nl'));
        for(const [title,list] of groups){
          const h=document.createElement('h2');h.className='group-title';h.textContent=title;grid.appendChild(h);
          list.forEach(c=>grid.appendChild(card(c)));
        }
      } else if(state.groupByFranchise){
        const grouped=groupBy(items,c=>c.franchise||'Onbekende franchise');
        const groups=Object.entries(grouped).sort((a,b)=>a[0].localeCompare(b[0],'nl'));
        for(const [title,list] of groups){
          const h=document.createElement('h2');h.className='group-title';h.textContent=title;grid.appendChild(h);
          list.forEach(c=>grid.appendChild(card(c)));
        }
      } else {
        items.forEach(c=>grid.appendChild(card(c)));
      }

      if(!items.length){
        const div=document.createElement('div');
        div.className='card';
        div.innerHTML=`<div class="card-body"><h3>Geen resultaten</h3><p class="meta">Probeer minder filters of een andere zoekterm.</p></div>`;
        grid.appendChild(div);
      }
    }

    function card(c){
      const tpl=$('#cardTemplate');
      const el=tpl.content.firstElementChild.cloneNode(true);
      $('img',el).src=c.minifigure?.imageUrl||'';
      $('.name',el).textContent=c.name;
      $('.franchise', el).textContent = c.franchise || 'Onbekend';
      const ab=$('.abilities',el);(c.abilities||[]).forEach(a=>{const s=document.createElement('span');s.className='ability';s.textContent=a;ab.appendChild(s);});
      const p = $('.pack', el);
      const waveTxt = c.pack?.releaseWave != null ? `Wave ${c.pack.releaseWave}` : 'Wave ?';
      p.innerHTML = [
        `<span class="pill">${c.pack?.type || 'Pack'}</span>`,
        `<b class="pack-name">${c.pack?.name || 'Onbekend'}</b>`,
        `<span class="pack-wave">• ${waveTxt}</span>`
      ].join('');
      return el;
    }

    // events
    $('#q').addEventListener('input',e=>{state.filters.q=e.target.value;render();});
    $('#franchise').addEventListener('change',e=>{state.filters.franchise=e.target.value;render();});
    $('#type').addEventListener('change',e=>{state.filters.type=e.target.value;render();});
    $('#wave').addEventListener('change',e=>{state.filters.wave=e.target.value;render();});
    $('#ability').addEventListener('change',e=>{const v=e.target.value;if(!v)return;if(!state.filters.abilities.includes(v))state.filters.abilities.push(v);e.target.value='';render();});
    $('#clearFilters').addEventListener('click',()=>{state.filters={q:'',franchise:'',type:'',wave:'',abilities:[]};$('#q').value='';$('#franchise').value='';$('#type').value='';$('#wave').value='';render();});
    $('#groupPack').addEventListener('click',e=>{state.groupByPack=!state.groupByPack;state.groupByFranchise=false;$('#groupFranchise').setAttribute('aria-pressed','false');e.currentTarget.setAttribute('aria-pressed',String(state.groupByPack));render();});
    $('#groupFranchise').addEventListener('click',e=>{state.groupByFranchise=!state.groupByFranchise;state.groupByPack=false;$('#groupPack').setAttribute('aria-pressed','false');e.currentTarget.setAttribute('aria-pressed',String(state.groupByFranchise));render();});

    load();
  </script>
</body>
</html>
